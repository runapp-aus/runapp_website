---
title: "R Learning Resources"
description: |
  Curated list of R learning resources
output: 
  distill::distill_article:
    toc: true
---

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">

<script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>


```{r setup, include=FALSE, echo=FALSE, message=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(rvest)
library(dplyr)
library(purrr)
library(htmltools)
library(knitr)

```

<style>
.card {
 
border: 2px solid #e7e7e7;
padding: .5rem;
 
}
</style>


```{r functions, echo=FALSE}


read_meta <- function(url){
  
  doc <- readLines(url, n = 300) |> # add way to check for end of header and iterate if not found
    paste0(collapse = '') |> # cleans parts of page where tag contents are across multiple rows
    iconv(to = '') |>
    gsub('Ã¢â‚¬â„¢', "'", .) |>
    read_html() |>
    html_nodes('meta, title')

  meta <- doc |>
    map_dfr(~ tibble(property = html_attr(.x, 'property'),
                     content = html_attr(.x, 'content'))) |>
    filter(!is.na(property))
    
  if (nrow(meta) == 0) {
    meta <- doc |>
      map_dfr(~ tibble(property = html_attr(.x, 'name'),
                       content = html_attr(.x, 'content'))) |>
      filter(!is.na(property))
  }
  
  # check for a title
  title <- doc |> html_nodes(xpath = "/html/head/title2") |> html_text()
  title_tag <- if ('og:title' %in% meta$property) 'title' else 'og:title'
  
  if (length(title) > 0) {
    meta <- meta |>
      add_row(property = title_tag,
              content = title)
  }
  
  return(meta)
  
}


card_url <- function(url, title, description, image, metadata_available){
  
  metadata_predefined <- tribble(~ property,       ~ content,
                                 'og:url',         url,
                                 'og:title',       title,
                                 'og:description', description,
                                 'og:image',       image)
  details <- read_meta(url) |>
    distinct()
  
  if (nrow(details) == 0){
    details <- metadata_predefined
  } else if (!any(grepl('og:', details$property))){
    details <- details |>
      bind_rows(metadata_predefined)
  } else if (!metadata_available) {
    details <- full_join(metadata_predefined, details) |>
      filter(!is.na(content)) |>
      group_by(property) |> 
      slice(1)
  }
  
  card_title <- details |> filter(property == 'og:title') |> pull(content)
  card_url <- details |> filter(property == 'og:url') |> pull(content)
  card_text <- details |> filter(property == 'og:description') |> pull(content)
  card_img <- details |> filter(property == 'og:image') |> pull(content)
  card_img_alt <- details |> filter(property == 'og:image:alt') |> pull(content) # TODO: use title if metadata missing
  
  
  div(class = 'card rounded border-dark',
      style = 'margin-bottom:70px',
      div(class="row no-gutters",
          div(class = 'col-sm-7',
              div(class = 'card-body',
                  h4(class = 'card-title',
                     a(href = card_url,
                       iconv(card_title))
                     ),
                  p(class="card-text text-secondary",
                    iconv(card_text, to = 'UTF-8'))
                )
              ),
          div(class = 'col-sm-5',
              if (length(card_img) > 0) img(class="card-img-top h-100", src = card_img, alt = card_img_alt) else ''
              )
          )
      )
}

safe_card <- safely(card_url)


resources_add <- function(input_list, type){
    x <- output_list[[type]] |>
      split(f = output_list[[type]]$link) |>
      map(~ safe_card(.x$link, .x$title, .x$comment, .x$img, .x$metadata_available)) |>
      keep(~ !is.null(.x$result)) 
    
    names(x) <- NULL
  
    xx <- lapply(x, function(x){x$result})
  
    return(tagList(xx))
    
}
```


```{r lists, echo=FALSE}

out <- readr::read_csv('data/resources.csv') %>%
  mutate(metadata_available = metadata_available == 'yes')

output_list <- split(out, out$type)


```

## Books



```{r print books, eval=TRUE, echo=FALSE, message=FALSE, warning=FALSE, comment='##'}

br <- resources_add(output_list, 'Books')

br

```




## Guides



```{r print Guides, eval=FALSE, echo=FALSE, message=FALSE, warning=FALSE, comment='##'}

gr <- resources_add(output_list, 'Guides')

gr

```


## Search by Tags



```{r tags}

dt <- out %>%
  select(type, link) %>%
  DT::datatable(rownames = FALSE, filter = list(position = 'top'))

dt
```
